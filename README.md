# fr_docker
### API предназначен для создания и проведения опросов. 
Для создания API использованы *Django 2.2.10, Django REST framework.*
Создание опроса возможно только с логином администратора (не суперпользователя). Прохождение опроса возможно анонимно или с id пользователя. Права доступа настроены в специальных группах на уровне моделей. Присутствует стандартная админка Django, которая позволяет менять настройки пользователей. 
Суперпользователь логин fr_admin пароль fr_admin.
API работает с локальной БД SQLite через встроенный в Django тестовый веб-сервер. Используется токен-аутентификация, поэтому следует помнить о передаче токена в заголовках, если необходимо произвести авторизованный запрос. Предусмотрена возможность генерации новых токенов при запросе авторизации. 
Некоторые (возможно все) запросы возвращают больше информации, чем это делается по стандарту или по требованиям безопасности, в данном случае это не ошибка, а сделано для более простого тестирования работы системы.

### Для использования API необходимо загрузить архив в docker командой:
<b>docker load -i \<path to image tar file\> </b>
при запуске не забывать использовать ключ <i>--publish</i> с пробросом внешнего порта на внутренний 8000

### Использование API.

| Тип запроса  |  URI | права доступа  | действие  |
| ------------ | ------------ | ------------ | ------------ |
| GET |` admin/ ` | superuser  | доступ к админке Django  |
| PUT  |` admin-api/interview/`  | администратор опросов  |  создать новый опрос |
| PATCH | `admin-api/interviews/<int:id>/ ` |  администратор опросов | изменить опрос по его id  |
| PUT | `admin-api/question`/  | администратор опросов  |  создать новый вопрос в опросе |
| PATCH |` admin-api/questions/<int:id>/`  |  администратор опросов | изменить вопрос по его id  |
| POST  |` auth/ ` | без авторизации  |  получение токена для дальнейшей авторизации |
| GET  |` interviews/<int:id> ` | пользователь / админ	 | данные опроса по id (или всех опросов если id=0)  |
| GET  | `questions/<int:id>`  |  пользователь / админ	 |  данные вопроса по id (или всех вопросов если id=0) |
| GET  | `question-types/<int:id>`|  пользователь / админ	 | данные типов вопросов по id (или всех типов вопросов если id=0)   |
| GET  | `active-interviews/`  | без авторизации  | получение всех **активных** опросов   |
| GET |` interview-questions/<int:id>`  |  без авторизации |  получение id всех вопросов в опросе по id опроса  |
| PUT  |` add-ans/ ` |  без авторизации | охранение ответа на вопрос (данные пользователя и вопроса передаются в запросе. См примеры ниже)  |
| PATCH |` patch-ans/<int:id>/` |  без авторизации |  изменение ответа по его id |  
| GET |` user-answers/<int:id>/ ` |  без авторизации | получение всех ответов пользователя с привязкой к опросу и информацией о времени ответа и ip-адреса устройства доступа.  |





### Примеры использования  (X.X.X.X - ip сервера)

- **Добавление нового интервью**

Тип запроса	PUT<br>
*Запрос*	&nbsp;&nbsp; 	http://X.X.X.X:8000/admin-api/interview/<br>
*Заголовки*<br>
Authorization: &nbsp;&nbsp;   Token 9eb668d3741d4abfcddcf4fd665428027539c4ae<br>
Content-Type: &nbsp;&nbsp;    application/json<br>

Данные запроса<br>
  {<br>
"name":"интервью созданное через API",<br>
"date_start":"2021-05-22",<br>
"date_end":"2021-07-11",<br>
"text":"Это прекрасный опрос, который мы проводим для того, чтобы узнать ваше мнение по вопросу того, интересует ли вас, этот опрос"<br>
}


-  **Изменение интервью**

Тип запроса	*PATCH*<br>
*Запрос*&nbsp;&nbsp; http://X.X.X.X:8000/admin-api/interviews/1/<br>
*Заголовки*<br>
- Authorization: &nbsp;&nbsp;  Token 9eb668d3741d4abfcddcf4fd665428027539c4ae<br>
- Content-Type:  &nbsp;&nbsp;  application/json<br>

*Данные запроса*  (возможно использование любой комбинации полей)<br>
{<br>
"name":"интервью созданное через API",<br>
"date_end":"2021-07-11",<br>
"text":"Это прекрасный опрос, который мы проводим для того, чтобы узнать ваше мнение по вопросу того, интересует ли вас, что оно никого не интересует"<br>
}<br>

- Добавление нового вопроса в интервью (нужны id интервью. Типы вопроса: «T» -текстовый, «S» - один из вариантов, «M» - несколько из вариантов)

Тип запроса	PUT<br>
*Запрос*&nbsp;&nbsp; http://X.X.X.X:8000/admin-api/question/<br>
*Заголовки*<br>
- Authorization: &nbsp;&nbsp;  Token 9eb668d3741d4abfcddcf4fd665428027539c4ae<br>
- Content-Type:  &nbsp;&nbsp;  application/json<br>

*Данные запроса*<br>
{<br>
"interview_id":"1"<br>
"q_type":"S",<br>
"q_text":"Вам нравится наш новый вопрос?",<br>
"ans_vars":<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;            "1":"да",<br>
&nbsp;&nbsp;            "2":"нет",<br>
&nbsp;&nbsp;            "3":"не знаю"<br>
&nbsp;&nbsp;            }<br>
}<br>

- Добавление ответа на вопрос (нужен id-вопроса. При отсутствии id пользователя или неверный id, ответ добавляется от анонимного пользователя)

Тип запроса	PUT<br>
*Запрос*&nbsp;&nbsp; http://X.X.X.X:8000/add-ans/<br>
*Заголовки* <br>
- Content-Type: &nbsp;&nbsp;   application/json<br>

*Данные запроса*<br>
{<br>
&nbsp;&nbsp;"q_id":"1",<br>
&nbsp;&nbsp;"user_id":"3",<br>
&nbsp;&nbsp;"answer":"ответ на вопрос созданный скриптом"<br>
}<br>

- Получение всех ответов респондента по id<br>

Тип запроса	GET<br>
*Запрос* &nbsp;&nbsp;http://X.X.X.X:8000/user-answers/1/<br>
